<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>What is a Thread?</title>
    <link rel="stylesheet" href="../../style.css">
    <script src="../../index.js"></script>
</head>
<body>
    <header>
        <nav class="corporate-nav">
            <div class="nav-container">
                <div class="title-header">
                    <h1 class="title">What is a Thread?</h1>
                    <p class="subtitle">Great question. In Swift (and more broadly in iOS development), UI updates must be performed on the main thread. If you try to update UI elements from a background thread, you can encounter bugs, crashes, or UI that doesn't behave correctly.</p>
                </div>        
            </div>
        </nav>
    </header>

    <main>
        <section>
            <h2>üßµ What is a Thread?</h2>
            <ul>
                <li>A thread is a sequence of executable instructions.</li>
                <li>Main thread (also called UI thread) is where all user interface (UI) updates and event handling happen.</li>
                <li>Background threads (also called worker threads) are used for tasks like network calls, file I/O, data processing, etc., to avoid blocking the UI.</li>
            </ul>
        </section>

        <section>
            <h2>‚ö†Ô∏è Why UI Updates Must Be on the Main Thread</h2>
            <p>UIKit (and SwiftUI under the hood) is not thread-safe. This means it expects all interactions with UI components to happen on the main thread.</p>
            <p>For example, doing this on a background thread:</p>
            <pre><code>
DispatchQueue.global().async {
    self.label.text = "Hello" // ‚ùå This will crash or behave unpredictably
}                
            </code></pre>
            <p>Instead, you must do:</p>
            <pre><code>
DispatchQueue.main.async {
    self.label.text = "Hello" // ‚úÖ This is safe
}                
            </code></pre>
        </section>

        <section>
            <h2>üß† How Background Work and UI Updates Usually Flow</h2>
            <p>Here‚Äôs a common pattern:</p>
            <pre><code>
DispatchQueue.global().async {
    // 1. Do some work in the background (e.g., fetch data)
    let result = fetchDataFromServer()

    // 2. Update the UI on the main thread
    DispatchQueue.main.async {
        self.label.text = result
    }
}                
            </code></pre>

            <p>üîÅ Example in Firebase</p>
            <p>Firebase (including Firebase Auth) calls addStateDidChangeListener on the main thread by default, so this is safe:</p>
            <pre><code>
Auth.auth().addStateDidChangeListener { _, user in
    self.isSignedIn = (user != nil) // ‚úÖ Safe UI update
}                
            </code></pre>

            <p>But if you were doing something async, like this:</p>
            <pre><code>
Auth.auth().signIn(withEmail: ..., password: ...) { result, error in
    DispatchQueue.global().async {
        // Some background processing
        // ‚ùå DON'T update UI here

        DispatchQueue.main.async {
            // ‚úÖ Safe place to update UI
        }
    }
}                
            </code></pre>
            <p>‚úÖ Summary</p>
            <table>
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Thread</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>UI Updates</td>
                        <td>Main thread</td>
                        <td>Always required</td>
                    </tr>
                    <tr>
                        <td>Networking, file I/O, etc.</td>
                        <td>Background</td>
                        <td>Offload to avoid UI freezing</td>
                    </tr>
                    <tr>
                        <td>Firebase Auth state listener</td>
                        <td>Main thread</td>
                        <td>Already safe by default</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </main>

    <footer>
        <p class="copyright">
            &copy; <span id="year"></span> Aether Corp. All rights reserved.
        </p>
    </footer>
</body>
</html>
